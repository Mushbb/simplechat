서버프로그래밍 실습

Websocket과 HTTP요청을 확실히 분리
- 사용자로부터의 HTTP요청과 그 응답이 확실하면, 무조건 HTTP요청으로 처리

TODO
WebFlux 갖다버리기
STOMP를 이용해서 유저퇴장을 인식 (Heartbeat) - 퇴장하면 브로드캐스트 (1개만)

List<UserInfo>를 서비스 클래스로 옮겨서 전체유저를 통합관리
Map<UUID, Nickname>을 ChatRoom안에 넣어서 닉네임은 방마다 따로관리
lobby에서 로그인 (일단은 localStorage에 로그인정보 해서 로그인 유지되도록)
- DB에 로그인정보 저장

로그인 유지를 위한 JWT + 리프레시 토큰

--------------------------------------------------------------------------------------------

룸과 유저 분리 (유저는 서비스레벨에)
- 닉네임은 방마다 따로 ( 방에는 Map<id, nick> )

5. 슬래시명령어 /users : 참가인원 출력 (끊어진 연결 실시간 파악 해놓기?)
- 클라이언트 localStorage로 연결유지
- 변화 있을때마다 유저리스트 or 변경점 브로드캐스트
 --> 변화 = 입장 퇴장 닉변


- 너무 자주 바꿀때 닉변밴
방에 비밀번호, 로비: 방 생성할때 비밀번호
/누르면 /명령어 팝업리스트

6. @멘션

7. 리턴값 fetch를 위한 DTO 클래스 (인풋 아웃풋) -> 컨트롤러 캡슐화 문제도 해결됨
플랫폼 스프링(백엔드), 웹(프론트엔드)

0. 서버 브로드캐스트 -> 클라이언트 [서버는 콘솔창] v
1. 채팅 (서버-클라이언트) v
2. 클라이언트-서버-클라이언트 v
3. 여러유저 v
4. 여러세션 v
5. 유저등록 (DB추가), 로그저장



=================================================


- 유저리스트 상시출력
닉 바뀔때 브로드캐스트 (1개만)
닉네임 길이제한, /nick <nickname>

하이퍼링크는 링크로
채팅 친 시간 (ChatMessage:LocalDateTime)
- 시간을 통째로 저장하고(서버에만) 보내주는건 가공된 "yyyy-MM-dd hh:mm"

클라이언트 localStorage로 연결유지, 서버에선 id가 붙어서 오면 유저생성안함
-> getAllChat()에서 유저 생성하는 부분 분리 -> 유저를 먼저 생성하고, 그걸 넣어서 올챗

/clear

index.html은 이제 로비페이지 = 개설된 방 리스트를 받아와야해 만들기 누르면 만드는탭도
페이지 넘어가는걸로 하자 (GET) /chat.html?room={roomName}

1. 방 추가로 개설
socket	-> topic/{room}/public
/init 	-> /{room} 으로 변경 -> /{room} 요청했는데 방이 없으면 방 만들기
-> 나머지 기능은 전부 /{room}/* 엔드포인트로
-> {room}을 텍스트로 받으면, ChatRoom도 Map으로 넣어야해.
근데 번호로 넣으면 몇번인지 클라에서 알 수가 없단말이지..
Create 이런걸 주고, 리턴을 방 번호로? 근데 그럼 퉁칠수가 없음,.. 그냥 Map으로 하자
- PopsCount()로 하니까 서버챗이 있고없고가 차이를 만들어버리네 이건 안되겠군
- 서버를 별도의 유저로 분리 or 서버맨 여부에 따라 -1
